
export function renderScreen2() {
    // 1. Seleccionar y limpiar el contenedor principal
    const $screenContent = $('#screen-content');

    $screenContent.empty();

    // 2. Definir la frase objetivo
    const fraseObjetivo = "Mi animal favorito son los conejos";

    // 3. Crear el p√°rrafo de instrucci√≥n
    const $instruccionP = $('<p>').html(`Por favor, escribe exactamente la siguiente frase en el campo de abajo: <br><strong>"${fraseObjetivo}"</strong>`);

    // 4. Crear el campo de entrada de texto (el input)
    const $textInput = $('<input>', {
        id: 'textInput',
        type: 'text',
        placeholder: 'Escribe la frase aqu√≠...',
        // Estilo b√°sico para m√≥viles
    });

    // 5. Crear el √°rea de feedback (el output)
    const $feedbackOutput = $('<p>', { 
        id: 'output', 
        text: 'Esperando que escribas la frase...'
    });

    // 6. A√±adir todos los elementos al contenedor principal
    const $monitorization = $('<p>', { id: 'monitorization', text: '' });
    $screenContent.append($instruccionP, $textInput, $feedbackOutput, $monitorization);

    // 7. Adjuntar los eventos al input usando la funci√≥n pasada como par√°metro
    // Pasamos el input y el output al manejador de eventos.
    attachInputEvents($textInput, $feedbackOutput, $monitorization, fraseObjetivo);
}


function attachInputEvents($inputElement, $outputElement, $monitorization, targetPhrase) {
  
  function showData(data) {
    console.log(data); 
    $monitorization.html(`<pre>${JSON.stringify(data, null, 2)}</pre>`);
  }
      $inputElement.on('keydown', function(e) {
        const currentTime = Date.now();
        const currentValue = $(this).val();
        let keyChar = e.key;
        let logEntry = {
            timestamp: currentTime,
            time: new Date(currentTime).toLocaleString(),
            key: keyChar,
            currentText: currentValue, // El texto antes de esta pulsaci√≥n
            expectedChar: null,
            matchStatus: 'Neutral', // Por defecto 'Neutral'
            eventSource: 'keydown'
        };

        // 1. Manejar Teclas Especiales (Eliminar/Backspace)
        if (keyChar === 'Backspace' || keyChar === 'Delete') {
            logEntry.matchStatus = 'Correction';
            logEntry.expectedChar = (currentValue.length > 0) 
                ? targetPhrase[currentValue.length - 1] // Car√°cter que se estaba a punto de borrar
                : null;
            showData(logEntry);
            return; // Contin√∫a con el evento keydown normal
        }
        
        // 2. Manejar Teclas de Car√°cter (si no es una tecla de control como Shift, Alt, etc.)
        if (keyChar.length === 1) { 
          console.log("Primer if");
            const currentIndex = currentValue.length;
            const expected = targetPhrase[currentIndex];
            
            // Si el √≠ndice es v√°lido para la frase objetivo
            if (expected !== undefined) {
                console.log("Segundo if");

                logEntry.expectedChar = expected;
                
                // Comparaci√≥n para determinar si el car√°cter es correcto o un error
                if (keyChar === expected) {
                    console.log("Tercer if");

                    logEntry.matchStatus = 'Correct';
                } else {
                    logEntry.matchStatus = 'Error';
                }
            } else {
                // Si el usuario ya escribi√≥ la frase completa y sigue escribiendo
                logEntry.matchStatus = 'ExtraInput';
            }
            showData(logEntry);
        }
    });  



    // Verificar la frase completa
    $inputElement.on('input', function() {
        const userText = $(this).val();
        
        // La validaci√≥n es estricta (case sensitive y espacios)
        if (userText === targetPhrase) {
            $outputElement
                .text('¬°Correcto! Frase ingresada con √©xito. üéâ')
                .css('color', 'green');
        } else if (userText.length >= targetPhrase.length) {
             // Si el texto es m√°s largo o no coincide despu√©s de la longitud completa
            $outputElement
                .text('El texto no coincide con la frase objetivo. Int√©ntalo de nuevo.')
                .css('color', 'red');
        }
        else {
             $outputElement
                .text(`Escribiendo... (Faltan ${targetPhrase.length - userText.length} caracteres)`)
                .css('color', '#888');
        }
    });
}